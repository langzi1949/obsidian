#前端 #JavaScript #JS 

> 本文学习一下什么是迭代器和生成器

# 迭代器

很多编程语言上已经都实现了迭代器，JavaScript中在ES6过后也实现了

```js
let arr = [1, 4, 5];
let it = arr[Symbol.iterator]();
console.log(it.next());
```


# 生成器

生成器是ES6新增的一个很强大的结构，拥有在一个函数块内暂停和恢复代码执行的能力

生成器的形式是一个函数，函数名称前面加一个星号`*`表示他是一个生成器。只要是可以定义函数的地方，就可以定义生成器

```js
// 生成器函数声明
function* get() {}

// 生成器函数表达式
let get = function* () {};

// 作为对象字面量的方法的生成器函数
let foo = {
  *get() {},
};

// 作为类实例方法的生成器函数
class Foo {
  *get() {}
}

// 作为类的静态方法的生成器函数
class Foo {
  static *get() {}
}
```

> [!danger]
> 箭头函数不能用来定义生成器函数

## 使用方法

```js
function* get() {
  return 'foot';
}

let getObj = get();

console.log(getObj); //Object [Generator] {}
console.log(getObj.next()); //{ value: 'foot', done: true }
```

在调用生成器函数的时候，会产生一个生成器对象，一开始是处于暂停状态，与迭代器相似，生成器也实现了Iterator接口，具有`next()`方法，他会在执行`next()`方法时候，开始直接函数，直到函数体结束或者遇到`yield`中断

```js
function* get() {
  yield 'kobe';
  yield 'zmg';
  return 'foot';
}

let getObj = get();

console.log(getObj); //Object [Generator] {}
console.log(getObj.next()); //{ value: 'kobe', done: false }
console.log(getObj.next()); //{ value: 'zmg', done: false }
console.log(getObj.next()); //{ value: 'foot', done: true }
```

1. 生成器对象作为可迭代对象
	1. 在生成器对象上显式的调用`next()`方法的用处不大，应该将其当成可迭代对象

```js
function* get() {
  yield 'kobe';
  yield 'zmg';
  return 'foot';
}

for (const x of get()) {
  console.log(x);
}

// kobe
// zmg
```
注意，上面的代码不会输出foot。因为迭代器处理到return语句的时候已经完成了
有两种方式获取到return的结果，第一种就是直接用迭代器对象next()方法
第二种
```js
function* get() {
  yield 'kobe';
  yield 'zmg';
  return 'foot';
}
const generator = get();
let result;
let finalResult;

while (true) {
  result = generator.next();
  if (result.done) {
    finalResult = result.value;
    break;
  }

  console.log(result.value);
}
console.log(finalResult);
```
2. 使用`yield`实现输入输出
3. 产生可迭代对象
通过使用星号来增强yield的行为，让他能够迭代一个可以迭代的对象，从而一次产出一个值

```js
function* generatorFnA() {
	for (const x of [1, 2, 3]) {
		yield x;
	}
}
for (const x of generatorFnA()) {
	console.log(x);
}
// 1
// 2
// 3
// 下面的是等价的
function* generatorFnB() {
	yield* [1, 2, 3];
}
for (const x of generatorFnB()) {
	console.log(x);
}
```
