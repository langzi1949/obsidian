#前端 #JavaScript #JS 

# 1.  XMLHttpRequest

这个曾经是Ajax最重要的东西，它允许浏览器在后台发起Http请求，而不会中断用户与当前页面的交互。

```js
// 1. 创建 XMLHttpRequest 对象
const xhr = new XMLHttpRequest();

// 2. 配置请求
// open(method, url, async)
// method: GET, POST, PUT, DELETE 等
// url: 请求的资源地址
// async: 是否异步执行（大多数情况下为 true）
xhr.open('GET', 'https://api.example.com/data', true); // 异步 GET 请求

// 如果是 POST 请求，需要设置请求头
// xhr.setRequestHeader('Content-Type', 'application/json');

// 3. 监听请求状态变化
// readyState 有 5 种状态：
// 0: UNSENT (未初始化)
// 1: OPENED (已打开)
// 2: HEADERS_RECEIVED (已发送，已接收响应头)
// 3: LOADING (正在下载响应体)
// 4: DONE (请求完成)
xhr.onreadystatechange = function() {
  if (xhr.readyState === 4) { // 请求完成
    if (xhr.status >= 200 && xhr.status < 300) { // HTTP 状态码 2xx 表示成功
      console.log('请求成功！');
      console.log('响应数据：', xhr.responseText); // 字符串形式的响应数据
      const data = JSON.parse(xhr.responseText); // 如果是 JSON 数据，需要解析
      console.log('解析后的数据：', data);

      // 在这里更新 DOM，例如将数据显示在页面上
      document.getElementById('result').textContent = JSON.stringify(data, null, 2);

    } else {
      console.error('请求失败！状态码：', xhr.status);
      console.error('错误信息：', xhr.statusText);
    }
  }
};

// 4. 处理网络错误（可选，但推荐）
xhr.onerror = function() {
  console.error('网络请求出错！');
};

// 5. 发送请求
// 对于 GET 请求，send() 参数为 null 或空
// 对于 POST 请求，send() 参数为请求体数据（如 JSON 字符串）
xhr.send();

// 对于 POST 请求示例：
/*
xhr.open('POST', 'https://api.example.com/submit', true);
xhr.setRequestHeader('Content-Type', 'application/json');
const postData = { name: 'John Doe', age: 30 };
xhr.send(JSON.stringify(postData));
*/
```

# 2. 原生Fetch API

fetch()方法是暴露在全局作用域下的，调用这个方法，浏览器就会发起HTTP请求

fetch('url')  这个会返回一个期约，可以进行链式调用会更加的强大

```js
// GET 请求示例
fetch('https://api.example.com/data')
  .then(response => {
    // 检查响应状态码是否成功 (2xx)
    // response.ok 是一个布尔值，表示状态码在 200-299 范围内
    if (!response.ok) {
      throw new Error(`HTTP 错误！状态码: ${response.status}`);
    }
    // 解析 JSON 响应体
    return response.json(); // 或 .text()，.blob()，.arrayBuffer() 等
  })
  .then(data => {
    console.log('请求成功！');
    console.log('解析后的数据：', data);

    // 更新 DOM
    document.getElementById('result').textContent = JSON.stringify(data, null, 2);
  })
  .catch(error => {
    // 捕获网络错误或响应处理中的错误
    console.error('Fetch 请求出错：', error);
    // 这里可以显示错误消息给用户
  });

// POST 请求示例
const postData = { name: 'Jane Doe', email: 'jane@example.com' };

fetch('https://api.example.com/users', {
  method: 'POST', // 请求方法
  headers: {
    'Content-Type': 'application/json' // 设置请求头，告知服务器发送的是 JSON
  },
  body: JSON.stringify(postData) // 请求体数据，需要转换为 JSON 字符串
})
  .then(response => {
    if (!response.ok) {
      throw new Error(`HTTP 错误！状态码: ${response.status}`);
    }
    return response.json(); // 或 .text()
  })
  .then(data => {
    console.log('POST 请求成功，创建的用户是：', data);
  })
  .catch(error => {
    console.error('POST 请求出错：', error);
  });
```

